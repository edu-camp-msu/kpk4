<script>
    async function checkSelection() {
        const studentId = document.getElementById('studentId').value;
        const apiUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1QL94OOKAcLgZJKYu_2H0DIKVrZtXDyQf56Im4MIHJ14/values/ชีต6?alt=json&key=AIzaSyCqACrd7PlasdViCaPiJpv_2acct-efmdE';

        Swal.fire({
            title: 'กำลังโหลดข้อมูล...',
            text: 'กรุณารอสักครู่',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            const rows = data.values.slice(1); // ลบแถวหัวข้อออก

            const found = rows.find(row => row[0] === studentId);

            Swal.close();

            if (found) {
                const name = found[2];
                const nickname = found[3];
                const school = found[6];
                const province = found[7];
                const confirmationLink = found[4];

                if (found[5] === "ผ่าน") {
                    Swal.fire({
                        title: 'ยินดีด้วย คุณผ่านการคัดเลือกให้เป็นน้องค่าย KPK4',
                        html: `
                            <p><strong>ชื่อ-นามสกุล:</strong> ${name}</p>
                            <p><strong>ชื่อเล่น:</strong> ${nickname}</p>
                            <p><strong>โรงเรียน:</strong> ${school}</p>
                            <p><strong>จังหวัด:</strong> ${province}</p>
                        `,
                        icon: 'success',
                        confirmButtonText: 'ยืนยันสิทธิ์ (Google form)',
                        confirmButtonColor: '#3085d6',
                        showCloseButton: true,
                        didOpen: () => {
                            confetti({
                                particleCount: 150,
                                spread: 100,
                                origin: { y: 0.3 },
                                zIndex: 9999
                            });
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.open(confirmationLink, '_blank');
                        }
                    });
                } else if (found[5] === "ไม่ผ่าน") {
                    Swal.fire({
                        title: 'ขออภัย คุณไม่ผ่านการคัดเลือกให้เป็นน้องค่าย KPK4',
                        icon: 'error',
                        confirmButtonText: 'ปิด',
                        confirmButtonColor: '#d33',
                        showCloseButton: true
                    });
                } else if (found[5] === "สำรอง") {
                    Swal.fire({
                        title: 'คุณเป็นน้องค่ายตัวสำรอง KPK4',
                        html: `
                            <p><strong>ชื่อ-นามสกุล:</strong> ${name}</p>
                            <p><strong>ชื่อเล่น:</strong> ${nickname}</p>
                            <p><strong>โรงเรียน:</strong> ${school}</p>
                            <p><strong>จังหวัด:</strong> ${province}</p>
                        `,
                        icon: 'warning',
                        confirmButtonText: 'ปิด',
                        confirmButtonColor: '#f39c12',
                        showCloseButton: true
                    });
                }
            } else {
                Swal.fire({
                    title: 'ไม่พบรายชื่อ',
                    icon: 'warning',
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#f39c12',
                    showCloseButton: true
                });
            }
        } catch (error) {
            Swal.fire({
                title: 'เกิดข้อผิดพลาด',
                text: error.message,
                icon: 'error',
                confirmButtonText: 'ปิด',
                confirmButtonColor: '#d33',
                showCloseButton: true
            });
        }
    }
</script>
